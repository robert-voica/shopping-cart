/*! puppet-dom.js version: 1.3.0
 * (c) 2013 Joachim Wester
 * MIT license
 */
!function(a){function b(){var a=d.read("Location");return d.erase("Location"),a}var c=function(a){a||(a={});var c=a.callback;this.element=a.listenTo||document.body;var d=this.clickHandler.bind(this);this.historyHandler=this.historyHandler.bind(this),a.callback=function(a){this.listen(),c&&c.call(this,a)},this.listen=function(){this.listening=!0,this.element.addEventListener("click",d),window.addEventListener("popstate",this.historyHandler),this.element.addEventListener("puppet-redirect-pushstate",this.historyHandler)},this.unlisten=function(){this.listening=!1,this.element.removeEventListener("click",d),window.removeEventListener("popstate",this.historyHandler),this.element.removeEventListener("puppet-redirect-pushstate",this.historyHandler)},a.remoteUrl=a.remoteUrl||b()||window.location.href,Puppet.call(this,a)};c.prototype=Object.create(Puppet.prototype),c.prototype.morphUrl=function(a){history.pushState(null,null,a),this.network.changeState(a)},c.prototype.clickHandler=function(a){if(!a.ctrlKey&&!a.metaKey&&2!=a.which){a.detail&&a.detail.target&&(a=a.detail);var b=a.target;if("A"!==b.nodeName)for(var d=0;d<a.path.length;d++)if("A"==a.path[d].nodeName){b=a.path[d];break}var e=b.href||b.getAttribute("href");e&&c.isApplicationLink(e)?(a.preventDefault(),a.stopPropagation(),this.morphUrl(e)):"submit"===b.type&&a.preventDefault()}},c.prototype.historyHandler=function(){this.network.changeState(location.href)},c.isApplicationLink=function(a){if("string"==typeof a){var b=document.createElement("A");b.href=a,""==b.host&&(b.href=b.href),a=b}return a.protocol==window.location.protocol&&a.host==window.location.host};var d={create:function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}document.cookie=a+"="+b+d+"; path=/"},readAll:function(){if(""===document.cookie)return{};for(var a=document.cookie.split("; "),b={},c=0,d=a.length;d>c;c++){var e=a[c].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return b},read:function(a){return d.readAll()[a]},erase:function(a){d.create(a,"",-1)}};a.PuppetDOM=c}(window);